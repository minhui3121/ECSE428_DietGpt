<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Add Ingredient Â· DietApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">DietApp</a>
      </div>
    </nav>
    <main class="container">
      <div class="row">
        <div class="col-md-6">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Add Ingredient</h5>
              <form id="ingredientForm">
                <div class="mb-3">
                  <label for="name" class="form-label">Name</label>
                  <input type="text" id="name" class="form-control" placeholder="e.g., Rice" required>
                </div>
                <div class="mb-3">
                  <label for="unit" class="form-label">Unit</label>
                  <select id="unit" class="form-select" required>
                    <option value="">Select unit</option>
                    <option>GRAM</option>
                    <option>KILOGRAM</option>
                    <option>MILLILITER</option>
                    <option>LITER</option>
                    <option>PIECE</option>
                    <option>TEASPOON</option>
                    <option>TABLESPOON</option>
                    <option>CUP</option>
                  </select>
                </div>
                <button class="btn btn-primary" type="submit">Add</button>
              </form>
              <div id="alert" class="alert mt-3 d-none"></div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title">Ingredients</h5>
              <ul id="list" class="list-group"></ul>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script>
      const form = document.getElementById('ingredientForm');
      const list = document.getElementById('list');
      const alertBox = document.getElementById('alert');

      function showAlert(msg, type) {
        alertBox.className = 'alert mt-3 alert-' + type;
        alertBox.textContent = msg;
        alertBox.classList.remove('d-none');
        setTimeout(()=> alertBox.classList.add('d-none'), 3000);
      }

      async function fetchIngredients(){
        const res = await fetch('/api/ingredients');
        const data = await res.json();
        list.innerHTML='';
        data.forEach(i => {
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = \`\${i.name} <span class="badge text-bg-secondary">\${i.unit}</span>
            <button class="btn btn-sm btn-outline-danger">Delete</button>\`;
          li.querySelector('button').onclick = async () => {
            const delRes = await fetch('/api/ingredients/' + i.id, { method: 'DELETE' });
            if(delRes.status === 204) { showAlert('Deleted', 'success'); fetchIngredients(); }
            else showAlert('Delete failed', 'danger');
          };
          list.appendChild(li);
        });
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const name = document.getElementById('name').value;
        const unit = document.getElementById('unit').value;
        const res = await fetch('/api/ingredients', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ name, unit })
        });
        if(res.ok){
          showAlert('Added!', 'success');
          form.reset();
          fetchIngredients();
        } else {
          const data = await res.json().catch(()=>({error:'Validation failed'}));
          showAlert(data.error || 'Validation failed', 'danger');
        }
      });

      fetchIngredients();
    </script>
  </body>
</html>
